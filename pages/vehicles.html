<div class="page">
    <!-- HEADER -->
    <div class="vehicles-header">
        <div>
            <h2 class="page-heading">Vehicles</h2>
            <p class="page-subheading">Manage all vehicles and assignments</p>
        </div>
        <button class="btn btn-primary" id="addVehicleBtn">
            <span class="material-symbols-outlined" style="vertical-align:middle; font-size:18px;">add</span>
            Add New Vehicle
        </button>
    </div>

    <!-- VEHICLES GRID -->
    <div class="vehicles-grid" id="vehiclesGrid">
        <!-- Vehicle cards will be inserted here -->
    </div>
</div>

<!-- ADD VEHICLE MODAL - STEP 1: Vehicle Details -->
<div class="modal-overlay" id="addVehicleModal">
    <div class="modal-large">
        <div class="modal-header">
            <div>
                <div class="modal-title">Add New Vehicle - Vehicle Details</div>
                <div class="modal-subtitle">
                    <span class="material-symbols-outlined" style="font-size:16px; vertical-align:middle;">local_shipping</span>
                    Enter the vehicle and driver details to create a new vehicle entry.
                </div>
            </div>
            <button class="close-btn" id="closeVehicleModal">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>

        <div class="modal-body">
            <div class="form-group">
                <label>Vehicle Number *</label>
                <input type="text" id="vehicleNumber" class="form-input" placeholder="e.g., MH-12-AB-1234">
            </div>

            <div class="form-group">
                <label>Driver Name *</label>
                <input type="text" id="driverName" class="form-input" placeholder="Enter driver name">
            </div>

            <div class="form-group">
                <label>Contact Number *</label>
                <input type="tel" id="contactNumber" class="form-input" placeholder="+91 XXXXXXXXXX">
            </div>
        </div>

        <div class="modal-footer">
            <button class="btn btn-outline" id="cancelVehicleModal">Cancel</button>
            <button class="btn btn-primary" id="nextSelectParcels">Next: Select Parcels</button>
        </div>
    </div>
</div>

<!-- VEHICLE DETAILS MODAL -->
<div class="modal-overlay" id="vehicleDetailsModal">
    <div class="modal-xlarge">
        <div class="modal-header">
            <div>
                <div class="modal-title">
                    <span class="material-symbols-outlined" style="vertical-align:middle; margin-right:8px;">arrow_back</span>
                    <span onclick="closeVehicleDetailsModal()" style="cursor:pointer;">Back to Vehicles</span>
                </div>
            </div>
            <button class="close-btn" id="closeVehicleDetailsBtn">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>

        <div class="modal-body">
            <!-- Vehicle Header -->
            <div class="vehicle-details-header">
                <div class="vehicle-icon-large">
                    <span class="material-symbols-outlined">local_shipping</span>
                </div>
                <div>
                    <h2 id="detailVehicleNumber">-</h2>
                    <span class="status-badge" id="detailVehicleStatus">-</span>
                </div>
            </div>

            <!-- Vehicle Info Grid -->
            <div class="vehicle-info-grid">
                <div class="info-card">
                    <span class="material-symbols-outlined info-icon">person</span>
                    <div>
                        <div class="info-label">Driver Name</div>
                        <div class="info-value" id="detailDriverName">-</div>
                    </div>
                </div>
                <div class="info-card">
                    <span class="material-symbols-outlined info-icon">call</span>
                    <div>
                        <div class="info-label">Contact Number</div>
                        <div class="info-value" id="detailDriverPhone">-</div>
                    </div>
                </div>
                <div class="info-card">
                    <span class="material-symbols-outlined info-icon">inventory_2</span>
                    <div>
                        <div class="info-label">Total Assigned Boxes</div>
                        <div class="info-value" id="detailAssignedBoxes">-</div>
                    </div>
                </div>
            </div>

            <!-- Assigned Parcels Section -->
            <div class="details-section">
                <div class="section-header">
                    <span class="material-symbols-outlined">inventory_2</span>
                    <h3>Assigned Parcels (<span id="detailParcelCount">0</span>)</h3>
                    <button class="btn btn-danger btn-sm" id="closeDayBtn" onclick="closeDayAndClearAssignment()" style="margin-left: auto;">
                        <span class="material-symbols-outlined" style="font-size:16px; margin-right:4px;">check_circle</span>
                        Close Day & Clear Assignment
                    </button>
                </div>
                <div class="parcels-table-container" style="max-height: 300px;">
                    <table class="parcels-table">
                        <thead>
                            <tr>
                                <th>LR No.</th>
                                <th>Date</th>
                                <th>Company</th>
                                <th>Consignee</th>
                                <th>Destination</th>
                                <th>Articles</th>
                                <th>Assigned Date</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="detailParcelsTableBody">
                            <tr><td colspan="9" style="text-align:center; padding:20px;">No parcels assigned</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Recent Activity Section -->
            <div class="details-section">
                <div class="section-header">
                    <span class="material-symbols-outlined">history</span>
                    <h3>Recent Activity</h3>
                </div>
                <div class="activity-list" id="detailActivityList">
                    <div class="activity-item">
                        <div class="activity-dot activity-green"></div>
                        <div>
                            <div class="activity-text">Vehicle status updated to <strong>Dispatched</strong></div>
                            <div class="activity-time">2 hours ago</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- SELECT PARCELS MODAL - STEP 2: Assign Parcels -->
<div class="modal-overlay" id="selectParcelsModal">
    <div class="modal-xlarge">
        <div class="modal-header">
            <div>
                <div class="modal-title">Add New Vehicle - Select Parcels</div>
                <div class="modal-subtitle">
                    <span class="material-symbols-outlined" style="font-size:16px; vertical-align:middle;">local_shipping</span>
                    Vehicle Information
                </div>
            </div>
            <button class="close-btn" id="closeSelectParcelsModal">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>

        <div class="modal-body" style="max-height: 70vh; overflow-y: auto; padding-bottom: 20px;">
            <!-- Vehicle Info Summary -->
            <div class="vehicle-info-summary">
                <div class="info-item">
                    <span class="info-label">Vehicle No.</span>
                    <span class="info-value" id="summaryVehicleNo">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Driver</span>
                    <span class="info-value" id="summaryDriver">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Contact</span>
                    <span class="info-value" id="summaryContact">-</span>
                </div>
            </div>

            <!-- Available Parcels Header -->
            <div class="parcels-header">
                <h4>Available Parcels</h4>
                <span class="selected-count" id="selectedCount">0 selected</span>
            </div>

            <!-- Filter Section -->
            <div style="margin-bottom: 20px; padding: 20px; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border-radius: 12px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                <div style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center; gap: 8px; min-width: 180px;">
                        <span class="material-symbols-outlined" style="font-size: 20px; color: #64748b;">filter_alt</span>
                        <span style="font-size: 15px; font-weight: 600; color: #334155;">Search by City/Destination:</span>
                    </div>
                    <div style="position: relative; flex: 1; max-width: 350px; min-width: 250px;">
                        <span class="material-symbols-outlined" style="position: absolute; left: 14px; top: 50%; transform: translateY(-50%); font-size: 20px; color: #94a3b8;">search</span>
                        <input 
                            type="text" 
                            id="parcelCityFilter" 
                            placeholder="Type to filter parcels by city..." 
                            style="width: 100%; padding: 12px 16px 12px 48px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px; background: white; transition: all 0.2s ease; box-shadow: 0 1px 2px rgba(0,0,0,0.05);"
                            onkeyup="filterParcelsByCity()"
                            onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59,130,246,0.1)'"
                            onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='0 1px 2px rgba(0,0,0,0.05)'"
                        >
                    </div>
                    <button 
                        onclick="clearParcelFilter()" 
                        style="padding: 12px 20px; background: linear-gradient(135deg, #64748b 0%, #475569 100%); color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 2px 4px rgba(0,0,0,0.1);"
                        onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.15)'"
                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.1)'"
                    >
                        <span class="material-symbols-outlined" style="font-size: 16px; vertical-align: middle; margin-right: 4px;">clear</span>
                        Clear
                    </button>
                </div>
            </div>

            <!-- Parcels Table -->
            <div class="parcels-table-container" style="max-height: 300px; overflow-y: auto;">
                <table class="parcels-table">
                    <thead>
                        <tr>
                            <th style="width: 40px;"></th>
                            <th>LR No.</th>
                            <th>Company</th>
                            <th>Consignee</th>
                            <th>Destination</th>
                            <th>Articles</th>
                            <th>Weight</th>
                            <th>Type</th>
                        </tr>
                    </thead>
                    <tbody id="parcelsTableBody">
                        <!-- Parcels will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <div class="modal-footer" style="position: sticky; bottom: 0; background: white; border-top: 1px solid #e5e7eb; z-index: 10;">
            <button class="btn btn-outline" id="backToVehicleDetails">Back</button>
            <button class="btn btn-outline" id="cancelSelectParcels">Cancel</button>
            <button class="btn btn-black" id="createVehicleWithParcels">
                Create Vehicle & Assign (<span id="assignCount">0</span>)
            </button>
        </div>
    </div>
</div>
